"use strict";angular.module("leseulsteve.angular-mongoose",[]),angular.module("leseulsteve.angular-mongoose").factory("Hooks",["$q",function(a){function b(){this.hooks={pre:{},post:{}},this.allowedOperations={pre:["caching","create","save","remove"],post:["find","create","save","remove"]};var a=this;_.forEach(this.allowedOperations.pre,function(b){a.hooks.pre[b]=[]}),_.forEach(this.allowedOperations.post,function(b){a.hooks.post[b]=[]})}return b.prototype.register=function(a,b,c){if(_.isUndefined(this.hooks[a][b]))throw new Error('Operation "'+b+'" n\'est pas prise en charge par la fonction "'+a+'"');this.hooks[a][b].push(c)},b.prototype.process=function(b,c,d){var e=[];return _.forEach(this.hooks[b][c],function(b){var c=a.defer();e.push(c.promise);var f=function(){c.resolve(d)};b.apply(d,[f])}),a.all(e).then(function(){return d})},b}]),angular.module("leseulsteve.angular-mongoose").factory("RemoteStore",["$http",function(a){function b(a){this.apiUrl=a}function c(a,b){var c=_.map(a.split("/"),function(a){return _.startsWith(a,":")?b[a.substring(1)]:a});return c.join("/")+"/"+b._id}return b.prototype.find=function(b){var c=_.map(this.apiUrl.split("/"),function(a){if(_.startsWith(a,":")){var c=b[a.substring(1)];return b=_.omit(b,a.substring(1)),c}return a}),d={params:b?b:void 0};return a.get(c.join("/"),d).then(function(a){return a.data})},b.prototype.findById=function(b){return a.get(this.apiUrl+"/"+b).then(function(a){return a.data})},b.prototype.count=function(a){return this.find(a).then(function(a){return a.length})},b.prototype.create=function(b){var c=_.map(this.apiUrl.split("/"),function(a){return _.startsWith(a,":")?b[a.substring(1)]:a});return a.post(c.join("/"),b).then(function(a){return a.data})},b.prototype.update=function(b){if(_.isUndefined(b._id))return this.create(b);var d=c(this.apiUrl,b);return a.put(d,b).then(function(a){return a.data})},b.prototype.remove=function(b){var d=c(this.apiUrl,b);return a.delete(d)},b}]),angular.module("leseulsteve.angular-mongoose").factory("Schema",["$q","$http","Hooks","RemoteStore",function(a,b,c,d){var e=function(b){function e(a){this.getApiUrl=function(){return b},_.assign(this,a)}var f=new c,g=new d(b);return e.create=function(a){var b=new e(a);return f.process("pre","create",b).then(function(a){return g.create(a).then(function(a){return f.process("post","find",new e(a)).then(function(a){return f.process("post","create",a)})})})},e.find=function(b){return g.find(b).then(function(b){return a.all(_.map(b,function(a){return f.process("post","find",new e(a))}))})},e.findOne=function(a){return e.find(a).then(function(a){return a.length>0?a[0]:null})},e.findById=function(a){return g.findById(a).then(function(a){return f.process("post","find",new e(a))})},e.count=function(a){return g.count(a)},e.pre=function(a,b){f.register("pre",a,b)},e.post=function(a,b){f.register("post",a,b)},e.prototype.save=function(){return _.isUndefined(this._id)?f.process("pre","create",this).then(function(a){return g.create(a).then(function(a){return f.process("post","find",new e(a)).then(function(a){return f.process("post","create",a)})})}):f.process("pre","save",this).then(function(a){return g.update(a).then(function(a){return f.process("post","save",new e(a)).then(function(a){return f.process("post","find",a)})})})},e.prototype.remove=function(){return f.process("pre","remove",this).then(function(a){return g.remove(a).then(function(){return f.process("post","remove",a)})})},e};return e}]);
//# sourceMappingURL=angular-mongoose.min.js.map